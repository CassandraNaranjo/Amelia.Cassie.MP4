---
title: "Have Marvel Movies Become More Female Inclusive?"
author: "Written by: Amelia Stapleton and Cassie Naranjo"
date: "May 10th 2019"
output: 
  html_document:
    code_folding: hide
---
```{r, include = FALSE, echo = FALSE}
library(tidyverse)
library(ggplot2)
library(ggthemes)
library(RColorBrewer)
library(cowplot)
library(ggpubr)
library(gridExtra)
library(RMySQL)
library(ggthemes)
library(grid)
db <- dbConnect(MySQL(), 
                host = "scidb.smith.edu", 
                user = "mth292", 
                password = "RememberPi", 
                dbname = "imdb")
knitr::opts_chunk$set(connection = db, max.print = 20)
```

##Picture of Female Avengers characters
```{r, echo = FALSE}
url <- "https://66.media.tumblr.com/01c5147c146e8a756f00434317a78a8a/tumblr_pggq87zdF11wj2s3io1_400.jpg"
```

! [ ] ('url')

##Blurb about new endgame movie and how there are seemingly more diverse chracters, and also more female characters. Moving away from the white male superhero to superheros who are female and people of color. But really how more diverse is it gender wise?? Make sure to include a problem statement

##Talk about the avengers movie and the spread of the 4 over the course of the years...
hyperlink to the imdb website for each avengers movie?

Avengers Query
```{sql, connection = db, output.var = "avengers"} 
SELECT title.id, title.title, title.production_year, COUNT(cast_info.person_id) as N, name.gender, ((count(cast_info.person_id))/296)*100 as ratio
from title
join cast_info
on title.id = cast_info.movie_id
join name
on cast_info.person_id = name.id
where cast_info.movie_id like '4316706'and name.gender IS NOT NULL
group by name.gender; 
```

Age of Ultron Query
```{sql, connection = db, output.var = "age_of_ultron"}
SELECT title.id, title.title, title.production_year, COUNT(cast_info.person_id) as N, name.gender, ((count(cast_info.person_id))/290)*100 as ratio
from title
join cast_info
on title.id = cast_info.movie_id
join name
on cast_info.person_id = name.id
where cast_info.movie_id like '3313672'and name.gender IS NOT NULL
group by name.gender;
```

Infinty War Query
```{sql}
SELECT title.id, title.title, title.production_year, COUNT(cast_info.person_id) as N, name.gender, ((count(cast_info.person_id))/115)*100 as ratio
from title
join cast_info
on title.id = cast_info.movie_id
join name
on cast_info.person_id = name.id
where cast_info.movie_id like '3313680'and name.gender IS NOT NULL
group by name.gender;
```

```{sql, connection = db, output.var = "infinity_war"} 
SELECT title.id, title.title, title.production_year, COUNT(cast_info.person_id) as N, name.gender, ((count(cast_info.person_id))/115)*100 as ratio
from title
join cast_info
on title.id = cast_info.movie_id
join name
on cast_info.person_id = name.id
where cast_info.movie_id like '3313680'and name.gender IS NOT NULL
group by name.gender; 
```

```{r}
#Avengers Ggplot
avengers_plot <- ggplot(data = avengers, aes(x = title, y = ratio)) +
  geom_bar(color = "goldenrod3", stat = "identity", size = 1, aes(fill = gender)) +
   labs(caption = "2012", y = "Ratio of Total Actors", x = "The Avengers")+ 
  scale_fill_manual(values = c('#e31a1c', 'darkblue'), labels = c("Female Cast", "Male Cast")) + 
    theme(legend.title = element_blank(), 
          legend.position = "none", 
          axis.text.x = element_blank(), 
          axis.title.x = element_text(size = 15), 
          axis.ticks.x = element_blank(),
          plot.caption = element_text(size = 8)) +
  scale_y_continuous(limits = c(0, 100)) +
  annotate("text", x = 1.2, y = 79, label = "26%", color = "white", size = 5, fontface = 'bold')
```

```{r}
#Age of Ultron Ggplot
ultron_plot <- ggplot(data = age_of_ultron, aes(x = title, y = ratio)) +
  geom_bar(color = "goldenrod3", stat = "identity", size = 1, aes(fill = gender)) +
 labs(y = "Ratio of Total Actors", x = "Age of Ultron", caption = "2015") + scale_fill_manual(values = c('#e31a1c', 'darkblue'), labels = c("Female Cast", "Male Cast")) + 
    theme(legend.title = element_blank(), 
          legend.position = "none", 
          axis.text.x = element_blank(), 
          axis.title.x = element_text(size = 15), 
          axis.ticks.x = element_blank(),
          plot.title = element_blank(),
        axis.title.y = element_blank(),
        axis.text = element_text(size = 5, color = "black"),
        axis.text.y = element_blank(),
        plot.caption = element_text(size = 8)) +
  scale_y_continuous(limits = c(0, 100)) +
  annotate("text", x = 1.2, y = 74, label = "31%", color = "white", size = 5, fontface = 'bold')
```

```{r}
#Infinity War Ggplot
infinity_plot <- ggplot(data = infinity_war, aes(x = title, y = ratio)) +
  geom_bar(color = "goldenrod3", stat = "identity", size = 1, aes(fill = gender)) +
  labs(caption = "2018", y = "Ratio of Total Actors", x = "Infinity War") + 
  scale_fill_manual(values = c('#e31a1c', 'darkblue'), labels = c("Female Cast", "Male Cast")) + 
  scale_y_continuous(limits = c(0, 100)) + 
      theme(plot.title = element_blank(),
        axis.title.y = element_blank(),
        panel.background=element_blank(),
        panel.grid.major=element_blank(),
        panel.border = element_blank(),
        panel.grid.minor=element_blank(),
        plot.background=element_blank(),
        axis.text = element_text(size = 5, color = "black"),
        axis.text.y = element_blank(),
        legend.title = element_blank(),
        axis.text.x = element_blank(),
        axis.title.x = element_text(size = 15),
        axis.ticks.x = element_blank(),
        legend.position = c(0.1, 0.13),
        legend.text = element_text(colour="white", size=10, 
                                     face="italic"),
        plot.caption = element_text(size = 8)) +
  annotate("text", x = 1.2, y = 79, label = "26%", color = "white", size = 5, fontface = 'bold')
```

```{r}
#Creating merged data graphics
p <- plot_grid(avengers_plot, ultron_plot, infinity_plot, align = "v", nrow = 1, rel_widths = c(1/3.33, 1/3.33, 1/3.33))
```

```{r}
#Creating title of merged data graphic
title <- ggdraw() + draw_label("Actor Gender Ratios in Avengers Movies", fontface = 'bold')
```

```{r}
#Adding title to merged data graphics
plot_grid(title, p, ncol = 1, rel_heights=c(0.1, 1), rel_widths = c(1/3.33, 1/3.33, 1/3.33))
```

Looking at top 15 actors in each movie
#Age of Ultron
```{sql}
select movie_id, gender, count(distinct person_id), ((count(distinct person_id))/10)*100 as ratio
from cast_info
join name on cast_info.person_id = name.id
where movie_id =  4316706 and nr_order < 11 and role_id < 3
group by gender 
```
Ultron
```{sql, output.var = "age_of_ultron_10"}
select movie_id, gender, count(distinct person_id), ((count(distinct person_id))/10)*100 as ratio
from cast_info
join name on cast_info.person_id = name.id
where movie_id = 3313672 and nr_order < 11 and role_id < 3
group by gender
```

Avengers
```{sql, output.var = "avengers_10"}
select movie_id, gender, count(distinct person_id), ((count(distinct person_id))/10)*100 as ratio
from cast_info
join name on cast_info.person_id = name.id
where movie_id = 4316706 and nr_order < 11 and role_id < 3
group by gender 
```

```{sql}
select movie_id, gender, count(distinct person_id), ((count(distinct person_id))/10)*100 as ratio
from cast_info
join name on cast_info.person_id = name.id
where movie_id = 4316706 and nr_order < 11 and role_id < 3
group by gender 
```

```{r}
#Infinity data
movie_id <- c("3313680", "3313680")
gender <- c("f", "m")
people <- c("2", "8")
ratio <- c("20", "80")
```

```{r}
#Infinity data frame 
infinity_wars_2 <- data.frame(movie_id, gender, people, ratio)
```

```{r}
infinity_creation <- ggplot(data = infinity_wars_2, aes(x = movie_id, y = ratio)) + geom_bar(color = "goldenrod3", stat = "identity", size = 1, aes(fill = gender)) + 
    labs(x = "Infinity War", y = "Ratio of Top Actors", caption = "2018") + scale_fill_manual(values = c('#e31a1c', 'darkblue'), labels = c("Female Cast", "Male Cast")) + 
  theme(axis.text.y = element_blank(), 
  axis.ticks.y = element_blank(), 
  axis.title.y = element_blank(), 
  axis.text.x = element_blank(), 
  axis.ticks.x = element_blank(), 
  axis.title.x = element_blank(), 
  legend.title = element_blank(),
  legend.position = c(0.1, 0.13),
  legend.text = element_text(colour="white", size=10, 
                                     face="italic"))
```

```{r}
grob_20 <- grobTree(textGrob("20%", x= .78, y= .81,
  gp=gpar(col="white", fontsize= 15 , fontface="bold")))

grob_10 <- grobTree(textGrob("10%", x= .78, y= .90,
  gp=gpar(col="white", fontsize= 15 , fontface="bold")))
```

```{r}
ultron_plot_10 <- ggplot(data = age_of_ultron_10, aes(x = movie_id, y = ratio)) +
  geom_bar(color = "goldenrod3", stat = "identity", size = 1, aes(fill = gender)) +
 labs(x = "Age of Ultron", y = "Ratio of Top Actors", caption = "2015") + scale_fill_manual(values = c('#e31a1c', 'darkblue'), labels = c("Female Cast", "Male Cast")) + 
    theme(legend.title = element_blank(), 
          legend.position = "none", 
          axis.text.x = element_blank(), 
          axis.title.x = element_text(size = 15), 
          axis.ticks.x = element_blank(),
          plot.title = element_blank(),
        axis.title.y = element_blank(),
        axis.text = element_text(size = 5, color = "black"),
        axis.text.y = element_blank(),
        plot.caption = element_text(size = 8)) +
    annotation_custom(grob_10)
```

```{r}
avengers_plot_10 <- ggplot(data = avengers_10, aes(x = movie_id, y = ratio)) +
  geom_bar(color = "goldenrod3", stat = "identity", size = 1, aes(fill = gender)) +
 labs(x = "Avengers", y = "Ratio of Top Actors", caption = "2012") + scale_fill_manual(values = c('#e31a1c', 'darkblue'), labels = c("Female Cast", "Male Cast")) + 
    theme(legend.title = element_blank(), 
          legend.position = "none", 
          axis.text.x = element_blank(), 
          axis.title.x = element_text(size = 15), 
          axis.ticks.x = element_blank(),
          plot.caption = element_text(size = 8)) +
  scale_y_continuous(limits = c(0, 100)) +
  annotation_custom(grob_20)
```

```{r}
infinity_10 <- ggplot(data = avengers_10, aes(x = movie_id, y = ratio)) +
  geom_bar(color = "goldenrod3", stat = "identity", size = 1, aes(fill = gender)) +
 labs(x = "Infinity War", y = "Ratio of Top Actors", caption = "2018") + scale_fill_manual(values = c('#e31a1c', 'darkblue'), labels = c("Female Cast", "Male Cast")) + 
    theme(plot.title = element_blank(),
        axis.title.y = element_blank(),
        panel.background=element_blank(),
        panel.grid.major=element_blank(),
        panel.border = element_blank(),
        panel.grid.minor=element_blank(),
        plot.background=element_blank(),
        axis.text = element_text(size = 5, color = "black"),
        axis.text.y = element_blank(),
        legend.title = element_blank(),
        axis.text.x = element_blank(),
        axis.title.x = element_text(size = 15),
        axis.ticks.x = element_blank(),
        legend.position = c(0.1, 0.13),
        legend.text = element_text(colour="white", size=10, 
                                     face="italic"),
        plot.caption = element_text(size = 8)) +
    annotation_custom(grob_20)
```

```{r}
#Creating merged data graphics
p_10 <- plot_grid(avengers_plot_10, ultron_plot_10, infinity_10, align = "v", nrow = 1, rel_widths = c(1/3.33, 1/3.33, 1/3.33))
```

```{r}
#Creating title of merged data graphic
title_10 <- ggdraw() + draw_label("Top 10 Actor Gender Ratios in Avengers Movies", fontface = 'bold')
```

```{r}
#Adding title to merged data graphics
plot_grid(title_10, p_10, ncol = 1, rel_heights=c(0.1, 1))
```

##Counter-argument
##Talk about female lead roles as a whole in the movie industry -- has it gone up, done, what?
##Maybe look up box office numbers if the avengers movies did better when more female lead roles
 

##Footnotes:
 - No endgame data in imdb
 - Used avengers data for infinity data in graphic two because same numbers when we calculated it ourselves using the imdb website
 -  Github repository 

At least 800 words, no more than 1200
```{r, message = FALSE, echo = FALSE}
##Word Count
wordcountaddin::word_count()
```
